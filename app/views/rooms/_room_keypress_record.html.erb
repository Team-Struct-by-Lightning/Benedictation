
/*  records speech while user holds down ctrl-b
    98 = b, metaKey = ctrl
*/
var count = 0;


function tell(evt) {

    // if user presses & holds ctrl-b
  if (evt.which === 2) {
        ready_to_record = 2;
        bdown = 1;
        recordSpeech();
        // automatically trigger a keyup event after 10 seconds because
        //that's all the web speech api can handle
        trigger_function = setInterval(function() {
            jQuery.event.trigger({ type : 'keyup', which : 17, altKey: true });
            console.log("we are triggering intervals!!")
            return;
            clearInterval(trigger_function);
        }, 10000);
    }
    // send the recorded speech to our server
    //when user releases ctrl-b (or 10 second timeout triggers a keyup event)
    else if ((evt.which === 17) && evt.type === "keyup"){
        bdown = 0;
        console.log (evt.which, evt.type, evt.altKey);
        if( recordSpeech.recording == 1 && trigger_flag == 1) {
            trigger_flag = 0;
            ready_to_record = 3;
            clearInterval(trigger_function);
            console.log("cleared our interval!");
            speechRegRec.stop(); // stop recording
            // send the speech as a wav blob
            speechRegRec.exportWAV(function(blob) {
                speechRegRec.clear();
                ws.send(blob);
                console.log("sending blob: ",blob);
                ws.send("stop");    // Tells the server to stop listening and start analyzing
            });
        }
    }
};

$(document).bind('keydown keypress keyup', tell);