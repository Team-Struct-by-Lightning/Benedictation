var comm = new Icecomm('9gv3ODZorBS2kVuNwnugBeV432PcNX3Qn0HmW33ofxK/u5Xolu');
comm.connect(window.location.pathname);

    // Set up the WebSocket in onload; so that it is available for use elsewhere.
    var host = "localhost";
    var port = "8888";
    var uri = "/recognize";
    ws = new WebSocket("ws://" + host + ":" + port + uri );

    // get benedict's reply from the python server
    ws.onmessage = function(e) {
        console.log("data from server: ", e.data);
        if(e.data != ""){
            sendBennyReply(e.data);
        }

        ready_to_record = 1;
        recordSpeech.recording = 0;
        trigger_flag = 1;
    }

    // Initialize Icecomm
    console.log("Initialized Icecomm, waiting for user media permissions...");

    comm.on('local', function(options) {
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        audioContext = new AudioContext();
        ready_to_record = 1;
        localVideo.src = options.stream;
        localAudioStream = options.rawStream;
        console.log(localAudioStream.getAudioTracks());
        console.log("Obtained user camera/microphone approval");

        // Initialize our new recorder with its own copy of the local media stream
        var input = audioContext.createMediaStreamSource(localAudioStream);
        speechRegRec = new Recorder(input);
    });

    comm.on('connected', function(options) {
        // append video elements one after the other when new people join the chat
        document.getElementById("video-chat-body").appendChild(options.video);
    });

    comm.on('disconnect', function(options) {
        console.log('disconnect happening');
        document.getElementById(options.callerID).remove();
        stopRecording();
    });

    comm.on('data', function(options) {
        console.log("data: ",options.data);
        var message_data = options.data.split("@@@");
        if(message_data[0] === "benny"){
            appendNewBennyReply(options);
        }
        else{
            appendNewIM(options);
        }
    });
